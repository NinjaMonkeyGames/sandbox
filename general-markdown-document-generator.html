<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Markdown Builder</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>
<body>

<div class="modal-overlay" id="overlay" onclick="closeAllModals()"></div>

<div id="exampleModal" class="modal">
    <h3>âœ¨ Insert Example Text</h3>
    <label class="modal-label">Variable Text</label>
    <input type="text" id="exampleVarInput" placeholder="Enter variable text...">
    <div style="text-align:right;">
        <button onclick="closeAllModals()">Cancel</button> 
        <button onclick="insertExampleFinal()" style="background:var(--primary); color:white">Insert</button>
    </div>
</div>

<div id="glossaryModal" class="modal">
    <h3>ğŸ“– Add Glossary Term</h3>
    <label class="modal-label">Term</label>
    <input type="text" id="glossaryTerm" placeholder="e.g. API">
    <label class="modal-label">Description</label>
    <textarea id="glossaryDesc" class="wide-text" placeholder="Define the term..."></textarea>
    <div style="text-align:right;">
        <button onclick="closeAllModals()">Cancel</button> 
        <button onclick="insertGlossaryFinal()" style="background:var(--primary); color:white">Add to Glossary</button>
    </div>
</div>

<div id="assetModal" class="modal" style="width: 550px;">
    <h3>ğŸ“¦ Asset Builder</h3>
    <div class="asset-grid">
        <div><label class="modal-label">Filename</label><input type="text" id="assetFilename" placeholder="logo.png" oninput="autoGuessType()"></div>
        <div><label class="modal-label">Relative Path</label><input type="text" id="assetPath" value=".artefacts"></div>
    </div>
    <div class="asset-grid">
        <div><label class="modal-label">Hidden Status</label><select id="assetHidden"><option value="Inherited">Inherited</option><option value="Yes">Yes</option><option value="No">No</option></select></div>
        <div><label class="modal-label">Asset Type (Ext)</label><input type="text" id="assetType" placeholder="PNG"></div>
    </div>
    <div class="asset-grid">
        <div><label class="modal-label">In Repo</label><select id="assetInclude"><option value="Yes">Yes</option><option value="No">No</option></select></div>
        <div><label class="modal-label">Managed</label><select id="assetManaged"><option value="Yes">Yes</option><option value="No">No</option></select></div>
    </div>
    <div class="asset-grid">
        <div><label class="modal-label">CI Type</label><select id="assetCIType"><option value="feat">feat</option><option value="fix">fix</option><option value="docs">docs</option><option value="style">style</option><option value="refactor">refactor</option><option value="perf">perf</option><option value="test">test</option><option value="build">build</option><option value="ci">ci</option><option value="chore" selected>chore</option></select></div>
        <div><label class="modal-label">CI Scope</label><select id="assetCIScope"><option value="core">core</option><option value="api">api</option><option value="ui" selected>ui</option></select></div>
    </div>
    <label class="modal-label">Asset Purpose</label><textarea id="assetPurpose" class="wide-text"></textarea>
    <label class="modal-label">Contents Description</label><textarea id="assetDescription" class="wide-text"></textarea>
    <div style="text-align:right; margin-top:10px;"><button onclick="closeAllModals()">Cancel</button> <button onclick="insertAssetFinal()" style="background:var(--primary); color:white">Insert Asset</button></div>
</div>

<div id="emojiModal" class="modal"><h3>Insert Callout</h3><select id="emojiType"><option value="info">â„¹ï¸ Info</option><option value="tip">ğŸ’¡ Tip</option><option value="caution">âš ï¸ Caution</option><option value="warning">ğŸš« Warning</option></select><input type="text" id="emojiText" placeholder="Your message here..."><div style="text-align:right;"><button onclick="closeAllModals()">Cancel</button> <button onclick="insertEmojiFinal()" style="background:var(--primary); color:white">Insert</button></div></div>
<div id="codeModal" class="modal"><h3>Insert Code Block</h3><select id="codeLangSelect"></select><textarea id="codeContent" class="wide-text" placeholder="Paste code here..."></textarea><div style="text-align:right;"><button onclick="closeAllModals()">Cancel</button> <button onclick="insertCodeFinal()" style="background:var(--primary); color:white">Insert Code</button></div></div>

<div id="tableModal" class="modal">
    <h3>Interactive Table Builder</h3>
    <div style="margin-bottom: 10px; display: flex; gap: 8px;">
        <button onclick="adjustGrid(1,0)">+ Row</button>
        <button onclick="adjustGrid(-1,0)">- Row</button>
        <button onclick="adjustGrid(0,1)">+ Col</button>
        <button onclick="adjustGrid(0,-1)">- Col</button>
        <button onclick="resetGrid()" style="background: #ef4444; color:white;">Reset</button>
    </div>
    <div style="overflow-x: auto;">
        <table class="grid-builder">
            <thead><tr id="gridHead"></tr></thead>
            <tbody id="gridBody"></tbody>
        </table>
    </div>
    <div style="text-align:right; margin-top:15px;">
        <button onclick="closeAllModals()">Cancel</button>
        <button onclick="insertTableFinal()" style="background:var(--primary); color:white">Insert Table</button>
    </div>
</div>

<div id="linkModal" class="modal"><h3>Insert Link</h3><input type="text" id="linkText" placeholder="Display Text"><input type="text" id="linkUrl" placeholder="URL"><div style="text-align:right;"><button onclick="closeAllModals()">Cancel</button> <button onclick="insertLinkFinal()" style="background:var(--primary); color:white">Insert Link</button></div></div>
<div id="anchorModal" class="modal"><h3>Insert Anchor Link</h3><select id="anchorSelect"></select><div style="text-align:right;"><button onclick="closeAllModals()">Cancel</button> <button onclick="insertAnchorFinal()" style="background:var(--primary); color:white">Insert Link</button></div></div>
<div id="imageModal" class="modal"><h3>Insert Image</h3><input type="text" id="imgAlt" placeholder="Alt"><input type="text" id="imgUrl" placeholder="URL"><div style="text-align:right;"><button onclick="closeAllModals()">Cancel</button> <button onclick="insertImageFinal()" style="background:var(--primary); color:white">Insert Image</button></div></div>
<div id="listModal" class="modal"><h3 id="listTitle">Add Items</h3><div id="listItemsContainer"></div><button onclick="addListRow()" style="background:#334155; color:white; width:100%; margin-bottom:15px; padding:8px; border-radius:4px;">+ Item</button><div style="text-align:right;"><button onclick="closeAllModals()">Cancel</button> <button id="listSubmitBtn" style="background:var(--primary); color:white">Insert</button></div></div>
<div id="paraModal" class="modal"><h3>Insert Paragraph</h3><textarea id="paraTextArea" class="wide-text"></textarea><div style="text-align:right;"><button onclick="closeAllModals()">Cancel</button> <button onclick="insertParagraphFinal()" style="background:var(--primary); color:white">Insert</button></div></div>

<div id="headerModal" class="modal">
    <h3>Heading</h3>
    <select id="headerLevel">
        <option value="1">H1</option>
        <option value="2">H2</option>
        <option value="3">H3</option>
        <option value="4">H4</option>
        <option value="5">H5</option>
        <option value="6">H6</option>
    </select>
    <input type="text" id="headerText">
    <div style="text-align:right;">
        <button onclick="closeAllModals()">Cancel</button> 
        <button onclick="insertHeaderFinal()" style="background:var(--primary); color:white">Insert</button>
    </div>
</div>

<div class="toolbar">
    <input type="text" id="mainTitle" class="main-title-input" placeholder="Main Title (H1)" oninput="handleInput()">
    <div class="group">
        <button onclick="openHeaderModal()">H#</button>
        <button onclick="insert('**', '**')">B</button>
        <button onclick="insert('*', '*')">I</button>
        <button onclick="insert('~~', '~~')" class="strike-btn">abc</button>
        <button onclick="insert('`', '`')">` `</button>
        <button onclick="openCodeModal()">[ { } ]</button>
    </div>
    <div class="group">
        <button onclick="openParaModal()">Â¶ Para</button>
        <button onclick="openListModal('-')">- List</button>
        <button onclick="openListModal('checkbox')">â˜‘ Check</button>
        <button onclick="openTableModal()">ç”° Table</button>
        <button onclick="openAssetModal()" style="background: #fbbf24; color: #000;">ğŸ“¦ Asset</button>
        <button onclick="openImageModal()">ğŸ–¼ Img</button>
        <button onclick="openLinkModal()">ğŸ”— Link</button>
        <button onclick="openAnchorModal()">âš“ Anchor</button>
        <button onclick="openEmojiModal()">ğŸ’¡</button>
        <button onclick="openGlossaryModal()" style="background: #ec4899; color: white;">ğŸ“– Glossary</button>
        <button onclick="openExampleModal()" style="background: #8b5cf6; color: white;">âœ¨ Example</button>
        <button onclick="insert('\n\n---\n\n', '')">â Break</button>
        <button onclick="insertTOC()" style="background: #8b5cf6; color: white;">ğŸ“‹ TOC</button>
    </div>
    <button onclick="toggleDarkMode()" class="theme-btn" id="themeBtn">ğŸŒ™ Dark Mode</button>
    <div class="lock-container"><input type="checkbox" id="lockEditor" onchange="toggleLock()"><label for="lockEditor">Lock</label></div>
    <div style="margin-left:auto; display:flex; gap:5px;">
        <button onclick="clearAll()" style="background: #ef4444; color: white;">Clear</button>
        <button onclick="copyToClipboard()" style="background: #6366f1; color: white;">Copy</button>
        <button onclick="downloadMD()" style="background: #10b981; color: white;">Save</button>
    </div>
</div>

<div class="main">
    <div class="pane">
        <div class="label">Editor <span id="stats">Words: 0</span></div>
        <div class="editor-container">
            <div id="lineNumbers" class="line-numbers"></div>
            <div class="editor-wrapper">
                <div id="editor-title-display"></div>
                <textarea id="editor" spellcheck="false" oninput="handleInput()" onscroll="syncScroll('editor')"></textarea>
            </div>
        </div>
    </div>
    <div class="pane">
        <div class="label">Preview (Drag items to reorder)</div>
        <div class="preview-container">
            <div id="previewLineNumbers" class="line-numbers"></div>
            <div id="preview" class="preview" onscroll="syncScroll('preview')"></div>
        </div>
    </div>
</div>

<script src="script.js"></script>
</body>
</html>