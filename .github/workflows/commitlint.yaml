# .github/workflows/commitlint.yaml
name: Conventional Commit Linting (Official CLI)

# Define this file as a callable/reusable workflow
on:
  workflow_call:
    # No inputs needed

jobs:
  lint_commits:
    runs-on: ubuntu-latest
    
    steps:
      - name: ‚¨áÔ∏è Checkout Code
        uses: actions/checkout@v4
        with:
          # Fetch the entire history so commitlint can determine the range to check
          fetch-depth: 0 

      - name: üõ†Ô∏è Setup Node.js Environment
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use a stable Node.js version

      - name: üì¶ Install Commitlint and Dependencies
        run: |
          # Install the official commitlint CLI and the conventional config preset
          npm install --save-dev @commitlint/cli @commitlint/config-conventional
          # Note: If your project uses Yarn or pnpm, replace 'npm install' accordingly.

      - name: üìù Run Official Commitlint CLI
        env:
          # Set the configuration file environment variable
          COMMITLINT_CONFIG: commitlint.config.js
        run: |
          echo "Running commitlint using configuration file: $COMMITLINT_CONFIG"
          
          # This command executes the commitlint binary from the node_modules/.bin folder.
          # It checks commits between the current HEAD and the remote target branch's HEAD.
          npx commitlint --from=$(git merge-base origin/master HEAD) --to=HEAD

      - name: ‚öôÔ∏è Troubleshooting Output
        if: ${{ failure() }}
        run: |
          echo "Commit linting failed! Check 'commitlint.config.js' and ensure all commit messages follow the Conventional Commit rules."